{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "VES-SIG-1 Test Vectors",
  "description": "Test vectors for VES-SIG-1 agent signatures specification",
  "version": "1.0.0",
  "generated": "2025-12-22",

  "key_generation": {
    "description": "Ed25519 key generation test vectors",
    "vectors": [
      {
        "name": "test_key_1",
        "seed_hex": "9d61b19deffd5a60ba844af492ec2cc44449c5697b326919703bac031cae7f60",
        "private_key_hex": "9d61b19deffd5a60ba844af492ec2cc44449c5697b326919703bac031cae7f60",
        "public_key_hex": "d75a980182b10ab7d54bfed3c964073a0ee172f3daa62325af021a68f707511a"
      },
      {
        "name": "test_key_2",
        "seed_hex": "4ccd089b28ff96da9db6c346ec114e0f5b8a319f35aba624da8cf6ed4fb8a6fb",
        "private_key_hex": "4ccd089b28ff96da9db6c346ec114e0f5b8a319f35aba624da8cf6ed4fb8a6fb",
        "public_key_hex": "3d4017c3e843895a92b70aa74d1b7ebc9c982ccf2ec4968cc0cd55f12af4660c"
      },
      {
        "name": "test_key_3",
        "seed_hex": "c5aa8df43f9f837bedb7442f31dcb7b166d38535076f094b85ce3a2e0b4458f7",
        "private_key_hex": "c5aa8df43f9f837bedb7442f31dcb7b166d38535076f094b85ce3a2e0b4458f7",
        "public_key_hex": "fc51cd8e6218a1a38da47ed00230f0580816ed13ba3303ac5deb911548908025"
      }
    ]
  },

  "domain_separators": {
    "description": "Domain separator byte values for VES-SIG-1",
    "values": {
      "DOMAIN_EVENTSIG": {
        "ascii": "VES_EVENTSIG_V1",
        "hex": "5645535f4556454e545349475f5631",
        "length": 15
      },
      "DOMAIN_PAYLOAD_PLAIN": {
        "ascii": "VES_PAYLOAD_PLAIN_V1",
        "hex": "5645535f5041594c4f41445f504c41494e5f5631",
        "length": 20
      },
      "DOMAIN_LEAF": {
        "ascii": "VES_LEAF_V1",
        "hex": "5645535f4c4541465f5631",
        "length": 11
      },
      "DOMAIN_RECEIPT": {
        "ascii": "VES_RECEIPT_V1",
        "hex": "5645535f524543454950545f5631",
        "length": 14
      }
    }
  },

  "encoding_primitives": {
    "description": "Binary encoding test vectors",
    "u32_be": [
      { "input": 0, "expected_hex": "00000000" },
      { "input": 1, "expected_hex": "00000001" },
      { "input": 256, "expected_hex": "00000100" },
      { "input": 65535, "expected_hex": "0000ffff" },
      { "input": 4294967295, "expected_hex": "ffffffff" }
    ],
    "u64_be": [
      { "input": 0, "expected_hex": "0000000000000000" },
      { "input": 1, "expected_hex": "0000000000000001" },
      { "input": 4294967296, "expected_hex": "0000000100000000" }
    ],
    "enc_str": [
      {
        "input": "hello",
        "expected_hex": "0000000568656c6c6f",
        "description": "5 bytes UTF-8"
      },
      {
        "input": "InventoryItem",
        "expected_hex": "0000000d496e76656e746f72794974656d",
        "description": "13 bytes UTF-8"
      },
      {
        "input": "",
        "expected_hex": "00000000",
        "description": "Empty string"
      }
    ],
    "uuid_bytes": [
      {
        "uuid": "00000000-0000-0000-0000-000000000001",
        "expected_hex": "00000000000000000000000000000001"
      },
      {
        "uuid": "11111111-1111-1111-1111-111111111111",
        "expected_hex": "11111111111111111111111111111111"
      },
      {
        "uuid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
        "expected_hex": "a1b2c3d4e5f67890abcdef1234567890"
      }
    ]
  },

  "payload_plain_hash": {
    "description": "Payload hash computation test vectors",
    "vectors": [
      {
        "name": "simple_payload",
        "payload": {"delta": 100},
        "canonical_json": "{\"delta\":100}",
        "expected_hash_hex": "COMPUTE_FROM_IMPLEMENTATION",
        "note": "Hash = SHA256(DOMAIN_PAYLOAD_PLAIN || canonical_json)"
      },
      {
        "name": "inventory_adjustment",
        "payload": {"delta": 100, "reason": "shipment_receive", "location_bin": "A-12"},
        "canonical_json": "{\"delta\":100,\"location_bin\":\"A-12\",\"reason\":\"shipment_receive\"}",
        "expected_hash_hex": "COMPUTE_FROM_IMPLEMENTATION"
      },
      {
        "name": "nested_object",
        "payload": {"items": [1, 2, 3], "meta": {"version": 1}},
        "canonical_json": "{\"items\":[1,2,3],\"meta\":{\"version\":1}}",
        "expected_hash_hex": "COMPUTE_FROM_IMPLEMENTATION"
      }
    ]
  },

  "event_signing_params": {
    "description": "Event signing parameter test case",
    "test_event": {
      "ves_version": 1,
      "tenant_id": "00000000-0000-0000-0000-000000000001",
      "store_id": "00000000-0000-0000-0000-000000000002",
      "event_id": "11111111-1111-1111-1111-111111111111",
      "source_agent_id": "22222222-2222-2222-2222-222222222222",
      "agent_key_id": 1,
      "entity_type": "InventoryItem",
      "entity_id": "WIDGET-001",
      "event_type": "Adjusted",
      "created_at": "2025-01-01T00:00:00Z",
      "payload_kind": 0,
      "payload_plain_hash_hex": "0000000000000000000000000000000000000000000000000000000000000000",
      "payload_cipher_hash_hex": "0000000000000000000000000000000000000000000000000000000000000000"
    },
    "preimage_structure": [
      "DOMAIN_EVENTSIG (15 bytes)",
      "ves_version u32_be (4 bytes)",
      "tenant_id uuid (16 bytes)",
      "store_id uuid (16 bytes)",
      "event_id uuid (16 bytes)",
      "source_agent_id uuid (16 bytes)",
      "agent_key_id u32_be (4 bytes)",
      "entity_type enc_str (4 + 13 bytes)",
      "entity_id enc_str (4 + 10 bytes)",
      "event_type enc_str (4 + 8 bytes)",
      "created_at enc_str (4 + 20 bytes)",
      "payload_kind u32_be (4 bytes)",
      "payload_plain_hash (32 bytes)",
      "payload_cipher_hash (32 bytes)"
    ],
    "preimage_total_bytes": 218,
    "note": "Actual hash depends on exact string lengths"
  },

  "ed25519_signatures": {
    "description": "Ed25519 signature test vectors",
    "vectors": [
      {
        "name": "rfc8032_test_1",
        "private_key_hex": "9d61b19deffd5a60ba844af492ec2cc44449c5697b326919703bac031cae7f60",
        "public_key_hex": "d75a980182b10ab7d54bfed3c964073a0ee172f3daa62325af021a68f707511a",
        "message_hex": "",
        "signature_hex": "e5564300c360ac729086e2cc806e828a84877f1eb8e5d974d873e065224901555fb8821590a33bacc61e39701cf9b46bd25bf5f0595bbe24655141438e7a100b"
      },
      {
        "name": "rfc8032_test_2",
        "private_key_hex": "4ccd089b28ff96da9db6c346ec114e0f5b8a319f35aba624da8cf6ed4fb8a6fb",
        "public_key_hex": "3d4017c3e843895a92b70aa74d1b7ebc9c982ccf2ec4968cc0cd55f12af4660c",
        "message_hex": "72",
        "signature_hex": "92a009a9f0d4cab8720e820b5f642540a2b27b5416503f8fb3762223ebdb69da085ac1e43e15996e458f3613d0f11d8c387b2eaeb4302aeeb00d291612bb0c00"
      }
    ],
    "determinism_test": {
      "description": "Ed25519 signatures are deterministic - same inputs always produce same output",
      "private_key_hex": "9d61b19deffd5a60ba844af492ec2cc44449c5697b326919703bac031cae7f60",
      "message_hex": "48656c6c6f2c20576f726c6421",
      "expected_behavior": "Multiple sign() calls with same key and message produce identical signatures"
    }
  },

  "full_signing_test": {
    "description": "Complete event signing test case",
    "private_key_hex": "9d61b19deffd5a60ba844af492ec2cc44449c5697b326919703bac031cae7f60",
    "public_key_hex": "d75a980182b10ab7d54bfed3c964073a0ee172f3daa62325af021a68f707511a",
    "event": {
      "ves_version": 1,
      "tenant_id": "00000000-0000-0000-0000-000000000001",
      "store_id": "00000000-0000-0000-0000-000000000002",
      "event_id": "11111111-1111-1111-1111-111111111111",
      "source_agent_id": "22222222-2222-2222-2222-222222222222",
      "agent_key_id": 1,
      "entity_type": "InventoryItem",
      "entity_id": "WIDGET-001",
      "event_type": "Adjusted",
      "created_at": "2025-01-01T00:00:00Z",
      "payload_kind": 0,
      "payload": {"delta": 100, "reason": "test"}
    },
    "expected": {
      "note": "These values are implementation-specific - use to verify consistency",
      "payload_plain_hash_hex": "COMPUTE_FROM_IMPLEMENTATION",
      "payload_cipher_hash_hex": "0x0000000000000000000000000000000000000000000000000000000000000000",
      "event_signing_hash_hex": "COMPUTE_FROM_IMPLEMENTATION",
      "agent_signature_hex": "COMPUTE_FROM_IMPLEMENTATION"
    }
  },

  "verification_test_cases": {
    "description": "Signature verification test cases",
    "valid_signature": {
      "description": "Valid signature should verify successfully",
      "steps": [
        "1. Lookup public key from registry",
        "2. Recompute payload_plain_hash from payload",
        "3. Build EventSigningParams from event",
        "4. Compute event_signing_hash",
        "5. Verify signature with Ed25519"
      ]
    },
    "invalid_cases": [
      {
        "name": "tampered_payload",
        "description": "Modified payload should fail hash verification",
        "expected_error": "PayloadHashMismatch"
      },
      {
        "name": "wrong_public_key",
        "description": "Different agent's key should fail signature verification",
        "expected_error": "SignatureVerificationFailed"
      },
      {
        "name": "tampered_signature",
        "description": "Modified signature bytes should fail verification",
        "expected_error": "SignatureVerificationFailed"
      },
      {
        "name": "revoked_key",
        "description": "Revoked key should be rejected",
        "expected_error": "KeyRevoked"
      },
      {
        "name": "expired_key",
        "description": "Expired key (past grace period) should be rejected",
        "expected_error": "KeyExpired"
      },
      {
        "name": "unknown_key",
        "description": "Non-existent key_id should be rejected",
        "expected_error": "KeyNotFound"
      }
    ]
  },

  "merkle_leaf_integration": {
    "description": "Signature inclusion in Merkle leaf hash",
    "leaf_preimage_structure": [
      "DOMAIN_LEAF (11 bytes)",
      "tenant_id uuid (16 bytes)",
      "store_id uuid (16 bytes)",
      "sequence_number u64_be (8 bytes)",
      "event_signing_hash (32 bytes)",
      "agent_signature (64 bytes)"
    ],
    "total_bytes": 147,
    "note": "Agent signature is committed in Merkle tree for verifiability"
  },

  "key_registry": {
    "description": "Key registry test data",
    "sample_entries": [
      {
        "tenant_id": "00000000-0000-0000-0000-000000000001",
        "agent_id": "22222222-2222-2222-2222-222222222222",
        "key_id": 1,
        "public_key_hex": "d75a980182b10ab7d54bfed3c964073a0ee172f3daa62325af021a68f707511a",
        "status": "active",
        "valid_from": "2025-01-01T00:00:00Z",
        "valid_to": null
      },
      {
        "tenant_id": "00000000-0000-0000-0000-000000000001",
        "agent_id": "22222222-2222-2222-2222-222222222222",
        "key_id": 2,
        "public_key_hex": "3d4017c3e843895a92b70aa74d1b7ebc9c982ccf2ec4968cc0cd55f12af4660c",
        "status": "active",
        "valid_from": "2025-06-01T00:00:00Z",
        "valid_to": null
      },
      {
        "tenant_id": "00000000-0000-0000-0000-000000000001",
        "agent_id": "33333333-3333-3333-3333-333333333333",
        "key_id": 1,
        "public_key_hex": "fc51cd8e6218a1a38da47ed00230f0580816ed13ba3303ac5deb911548908025",
        "status": "revoked",
        "valid_from": "2025-01-01T00:00:00Z",
        "revoked_at": "2025-03-15T10:30:00Z"
      }
    ]
  },

  "validation_checklist": {
    "description": "Validation rules implementations MUST enforce",
    "rules": [
      "ves_version MUST be 1",
      "event_id MUST be valid UUID",
      "tenant_id MUST be valid UUID",
      "store_id MUST be valid UUID",
      "source_agent_id MUST be valid UUID",
      "agent_key_id MUST be non-negative integer",
      "entity_type MUST be non-empty string",
      "entity_id MUST be non-empty string",
      "event_type MUST be non-empty string",
      "created_at MUST be valid RFC 3339 timestamp",
      "payload_kind MUST be 0 or 1",
      "payload_plain_hash MUST be 32 bytes (64 hex chars)",
      "payload_cipher_hash MUST be 32 bytes (64 hex chars)",
      "agent_signature MUST be 64 bytes (128 hex chars)",
      "For payload_kind=0, payload_cipher_hash MUST be all zeros",
      "For payload_kind=0, payload MUST be present",
      "For payload_kind=1, payload_encrypted MUST be present",
      "Agent key MUST exist and be valid at verification time",
      "Signature MUST verify with agent's public key"
    ]
  }
}
